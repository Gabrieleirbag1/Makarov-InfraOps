"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendFaroEvents = void 0;
var otlp_transformer_1 = require("@opentelemetry/otlp-transformer");
var faro_core_1 = require("@grafana/faro-core");
function sendFaroEvents(resourceSpans) {
    var _a, _b;
    if (resourceSpans === void 0) { resourceSpans = []; }
    for (var _i = 0, resourceSpans_1 = resourceSpans; _i < resourceSpans_1.length; _i++) {
        var resourceSpan = resourceSpans_1[_i];
        var scopeSpans = resourceSpan.scopeSpans;
        for (var _c = 0, scopeSpans_1 = scopeSpans; _c < scopeSpans_1.length; _c++) {
            var scopeSpan = scopeSpans_1[_c];
            var scope = scopeSpan.scope, _d = scopeSpan.spans, spans = _d === void 0 ? [] : _d;
            for (var _e = 0, spans_1 = spans; _e < spans_1.length; _e++) {
                var span = spans_1[_e];
                if (span.kind !== otlp_transformer_1.ESpanKind.SPAN_KIND_CLIENT) {
                    continue;
                }
                var spanContext = {
                    traceId: span.traceId.toString(),
                    spanId: span.spanId.toString(),
                };
                var faroEventAttributes = {};
                for (var _f = 0, _g = span.attributes; _f < _g.length; _f++) {
                    var attribute = _g[_f];
                    faroEventAttributes[attribute.key] = String(Object.values(attribute.value)[0]);
                }
                var index = ((_a = scope === null || scope === void 0 ? void 0 : scope.name) !== null && _a !== void 0 ? _a : '').indexOf('-');
                var eventName = faro_core_1.unknownString;
                if (scope === null || scope === void 0 ? void 0 : scope.name) {
                    if (index === -1) {
                        eventName = (_b = scope.name.split('/')[1]) !== null && _b !== void 0 ? _b : scope.name;
                    }
                    if (index > -1) {
                        eventName = scope === null || scope === void 0 ? void 0 : scope.name.substring(index + 1);
                    }
                }
                faro_core_1.faro.api.pushEvent("faro.tracing.".concat(eventName), faroEventAttributes, undefined, { spanContext: spanContext });
            }
        }
    }
}
exports.sendFaroEvents = sendFaroEvents;
//# sourceMappingURL=faroTraceExporter.utils.js.map