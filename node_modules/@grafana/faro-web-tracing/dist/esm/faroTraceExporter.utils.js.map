{"version":3,"file":"faroTraceExporter.utils.js","sourceRoot":"","sources":["../../src/faroTraceExporter.utils.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,SAAS,EAAkB,MAAM,iCAAiC,CAAC;AAE5E,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAC;AAGzD,MAAM,UAAU,cAAc,CAAC,gBAAkC,EAAE;;IACjE,KAAK,MAAM,YAAY,IAAI,aAAa,EAAE;QACxC,MAAM,EAAE,UAAU,EAAE,GAAG,YAAY,CAAC;QAEpC,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE;YAClC,MAAM,EAAE,KAAK,EAAE,KAAK,GAAG,EAAE,EAAE,GAAG,SAAS,CAAC;YAExC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;gBACxB,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,CAAC,gBAAgB,EAAE;oBAC5C,SAAS;iBACV;gBAED,MAAM,WAAW,GAA4C;oBAC3D,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE;oBAChC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE;iBAC/B,CAAC;gBAEF,MAAM,mBAAmB,GAAwB,EAAE,CAAC;gBAEpD,KAAK,MAAM,SAAS,IAAI,IAAI,CAAC,UAAU,EAAE;oBACvC,mBAAmB,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;iBAChF;gBAED,MAAM,KAAK,GAAG,CAAC,MAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,IAAI,mCAAI,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;gBAC/C,IAAI,SAAS,GAAG,aAAa,CAAC;gBAE9B,IAAI,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,IAAI,EAAE;oBACf,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;wBAChB,SAAS,GAAG,MAAA,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,mCAAI,KAAK,CAAC,IAAI,CAAC;qBACpD;oBAED,IAAI,KAAK,GAAG,CAAC,CAAC,EAAE;wBACd,SAAS,GAAG,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;qBAC9C;iBACF;gBAED,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,gBAAgB,SAAS,EAAE,EAAE,mBAAmB,EAAE,SAAS,EAAE,EAAE,WAAW,EAAE,CAAC,CAAC;aAClG;SACF;KACF;AACH,CAAC","sourcesContent":["import type { SpanContext } from '@opentelemetry/api';\nimport { ESpanKind, IResourceSpans } from '@opentelemetry/otlp-transformer';\n\nimport { faro, unknownString } from '@grafana/faro-core';\nimport type { EventAttributes as FaroEventAttributes } from '@grafana/faro-web-sdk';\n\nexport function sendFaroEvents(resourceSpans: IResourceSpans[] = []) {\n  for (const resourceSpan of resourceSpans) {\n    const { scopeSpans } = resourceSpan;\n\n    for (const scopeSpan of scopeSpans) {\n      const { scope, spans = [] } = scopeSpan;\n\n      for (const span of spans) {\n        if (span.kind !== ESpanKind.SPAN_KIND_CLIENT) {\n          continue;\n        }\n\n        const spanContext: Pick<SpanContext, 'traceId' | 'spanId'> = {\n          traceId: span.traceId.toString(),\n          spanId: span.spanId.toString(),\n        };\n\n        const faroEventAttributes: FaroEventAttributes = {};\n\n        for (const attribute of span.attributes) {\n          faroEventAttributes[attribute.key] = String(Object.values(attribute.value)[0]);\n        }\n\n        const index = (scope?.name ?? '').indexOf('-');\n        let eventName = unknownString;\n\n        if (scope?.name) {\n          if (index === -1) {\n            eventName = scope.name.split('/')[1] ?? scope.name;\n          }\n\n          if (index > -1) {\n            eventName = scope?.name.substring(index + 1);\n          }\n        }\n\n        faro.api.pushEvent(`faro.tracing.${eventName}`, faroEventAttributes, undefined, { spanContext });\n      }\n    }\n  }\n}\n"]}